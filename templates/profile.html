{% extends "base.html" %}
{% load socialaccount %}
{% load profile_tags %}
{% get_providers as socialaccount_providers %}
{% get_social_accounts user as accounts %}
{% block head_title %}
Profile
{% endblock head_title %}
{% block content %}
<div class="container mx-auto px-4 py-8">
  <div class="max-w-4xl mx-auto" data-aos="fade-up">
    <!-- Profile Card -->
    <div class="retro-card p-6 md:p-8">
      <div class="pixel-accent mb-6"></div>

      <!-- Avatar & Username -->
      <div class="flex flex-col items-center mb-8">
        <div class="pixel-border pixelated w-24 h-24 md:w-32 md:h-32 mb-4 relative">
          <img src="{% avatar user %}" alt="Profile" class="w-full h-full object-cover pixelated">
        </div>
        <div class="flex items-center gap-2">
          <h1 class="font-pixel text-xl md:text-2xl text-primary crt-glow">{{ user.username }}</h1>
          {% if user.emailaddress_set.all.0.verified %}
          <i class="ph-fill ph-shield-check text-primary text-xl crt-glow-sm" title="Verified"></i>
          {% else %}
          <i class="ph-fill ph-warning text-secondary text-xl crt-glow-sm" title="Pending"></i>
          {% endif %}
        </div>
        <a href="{% url 'edit_profile' %}"
          class="retro-btn bg-secondary text-dark border-secondary mt-4 px-6 py-2 text-xs flex items-center gap-2 inline-flex">
          <i class="ph-bold ph-pencil-simple"></i>
          <span>Edit Profile</span>
        </a>
      </div>

      <div class="pixel-accent-amber mb-6"></div>

      <!-- Stats Grid -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div class="retro-container p-4 text-center">
          <i class="ph-fill ph-medal-military text-3xl text-secondary mb-2 crt-glow-sm block"></i>
          <p class="font-pixel text-xs text-light/60 mb-1">Rank</p>
          <p class="text-xl font-bold text-light">{{ rank|safe }}</p>
        </div>

        <div class="retro-container p-4 text-center">
          <i class="ph-fill ph-chart-line-up text-3xl text-primary mb-2 crt-glow-sm block"></i>
          <p class="font-pixel text-xs text-light/60 mb-1">Score</p>
          <p class="text-xl font-bold text-light">{{ profile.score }}</p>
        </div>

        <div class="retro-container p-4 text-center">
          <i class="ph-fill ph-trend-up text-3xl text-secondary mb-2 crt-glow-sm block"></i>
          <p class="font-pixel text-xs text-light/60 mb-1">Level</p>
          <p class="text-xl font-bold text-light">{{ profile.current_level }}</p>
        </div>
      </div>

      <!-- User Info -->
      <div class="space-y-3">
        <h3 class="font-pixel text-sm text-primary crt-glow-sm mb-4 flex items-center gap-2">
          <i class="ph-fill ph-user-gear"></i>
          User Info
        </h3>

        <div class="retro-container p-4">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 pb-3">
            <div class="flex items-center gap-2 flex-1 min-w-0">
              <i class="ph-fill ph-envelope text-primary"></i>
              <span class="retro-text text-light truncate text-base">{{ user.email }}</span>
            </div>
            {% if user.emailaddress_set.all.0.verified %}
            <span class="inline-flex items-center gap-1 text-primary text-xs bg-primary/10 px-3 py-1 rounded">
              <i class="ph-fill ph-seal-check"></i>
              Verified
            </span>
            {% else %}
            <form action="{% url 'send_confirmation_email' %}" method="post">
              {% csrf_token %}
              <button type="submit" class="retro-btn bg-secondary text-dark border-secondary px-4 py-1 text-xs">
                <i class="ph-bold ph-paper-plane-tilt text-xs"></i>
                Verify
              </button>
            </form>
            {% endif %}
          </div>

          <div class="pixel-accent-amber my-3"></div>

          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 py-3">
            <div class="flex items-center gap-2 flex-1 min-w-0">
              <i class="ph-fill ph-user text-secondary"></i>
              {% if profile.name %}
              <span class="retro-text text-light text-base">{{ profile.name }}</span>
              {% else %}
              <span class="retro-text text-light/40 text-base">Display name not set</span>
              {% endif %}
            </div>
            {% if not profile.name %}
            <a href="{% url 'edit_profile' %}"
              class="retro-btn bg-secondary text-dark border-secondary px-4 py-1 text-xs">
              <i class="ph-bold ph-pencil-simple text-xs"></i>
              Set
            </a>
            {% endif %}
          </div>

          <div class="pixel-accent-amber my-3"></div>

          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 pt-3">
            <div class="flex items-center gap-2 flex-1 min-w-0">
              <i class="ph-fill ph-graduation-cap text-secondary"></i>
              {% if profile.organization %}
              <span class="retro-text text-light text-base">{{ profile.organization }}</span>
              {% else %}
              <span class="retro-text text-light/40 text-base">Organization not set</span>
              {% endif %}
            </div>
            {% if not profile.organization %}
            <a href="{% url 'edit_profile' %}"
              class="retro-btn bg-secondary text-dark border-secondary px-4 py-1 text-xs">
              <i class="ph-bold ph-pencil-simple text-xs"></i>
              Set
            </a>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Account Actions -->
      <div class="mt-8">
        <div class="pixel-accent mb-4"></div>
        <h3 class="font-pixel text-sm text-primary crt-glow-sm mb-4 flex items-center gap-2">
          <i class="ph-fill ph-gear"></i>
          Account Actions
        </h3>
        <div class="space-y-3">
          <a href="{% url 'account_change_password' %}"
            class="retro-btn w-full bg-light text-dark border-light flex items-center gap-3 px-4 py-3 text-xs">
            <i class="ph-bold ph-password"></i>
            <span>Change Password</span>
          </a>
          <form action="{% url 'account_logout' %}" method="post">
            {% csrf_token %}
            <button type="submit"
              class="retro-btn w-full bg-dark text-secondary border-secondary flex items-center gap-3 px-4 py-3 text-xs">
              <i class="ph-bold ph-sign-out"></i>
              <span>Sign Out</span>
            </button>
          </form>
        </div>
      </div>

      <div class="pixel-accent-amber mt-6"></div>
    </div>
  </div>
</div>
{% endblock content %}
