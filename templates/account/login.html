{% extends "base.html" %}
{% load static %}
{% block head_title %}
Login
{% endblock head_title %}
{% block head %}
<style>
  /* Retro form container with SOLID background */
  .retro-form-container {
    border: 3px solid #08b74f;
    border-radius: 6px;
    background: #251809;
    box-shadow:
      inset 0 1px 0 rgba(255, 255, 255, 0.1),
      0 4px 0 rgba(8, 183, 79, 0.3),
      0 8px 30px rgba(0, 0, 0, 0.6);
  }

  /* Retro form buttons */
  .retro-form-btn {
    font-family: 'Press Start 2P', cursive;
    font-size: 0.7rem;
    padding: 0.875rem 1.5rem;
    border: 3px solid currentColor;
    border-radius: 4px;
    box-shadow:
      inset 0 -2px 0 rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.2),
      0 4px 0 rgba(0, 0, 0, 0.25);
    transition: all 0.15s;
    text-transform: uppercase;
  }

  .retro-form-btn:hover {
    transform: translateY(-1px);
    box-shadow:
      inset 0 -2px 0 rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.3),
      0 5px 0 rgba(0, 0, 0, 0.3);
  }

  .retro-form-btn:active {
    transform: translateY(2px);
    box-shadow:
      inset 0 -1px 0 rgba(0, 0, 0, 0.2),
      inset 0 2px 3px rgba(0, 0, 0, 0.3),
      0 2px 0 rgba(0, 0, 0, 0.2);
  }

  /* Remove the conflicting styles from form inputs within this page */
  .retro-form-wrapper input {
    border-color: rgba(221, 207, 181, 0.3) !important;
    font-size: 1rem !important;
  }

  .retro-form-wrapper input:focus {
    border-color: rgba(8, 183, 79, 0.8) !important;
  }
</style>
{% endblock head %}
{% block content %}
<div class="min-h-[90vh] flex items-center justify-center px-4 py-8">
  <div class="w-full max-w-md retro-form-wrapper">
    <div class="retro-form-container p-8">
      <!-- Header -->
      <div class="text-center mb-8">
        <div class="pixel-accent mb-6"></div>
        <div class="flex justify-center mb-4">
          <i class="ph-fill ph-user text-accent text-4xl crt-glow"></i>
        </div>
        <h1 class="font-pixel text-2xl text-primary crt-glow mb-2">Welcome Back!</h1>
        <p class="retro-text text-light/60 text-sm">
          Don't have an account?
          <a href="{% url 'account_signup' %}" class="text-secondary hover:text-secondary/80 font-bold">Sign up</a>
        </p>
      </div>

      <!-- Login Form -->
      <form method="post" action="{% url 'account_login' %}" id="login_form">
        {% csrf_token %}
        <div class="space-y-6">
          <!-- Email/Username -->
          <div>
            <label for="id_login" class="font-pixel text-xs text-light crt-glow-sm">
              Email or Username
            </label>
            <input type="text" name="login" required placeholder="Enter your email or username" class="w-full">
          </div>

          <!-- Password -->
          <div>
            <div class="text-center mb-2">
              <label for="id_password" class="font-pixel text-xs text-light crt-glow-sm">
                Password
              </label>
            </div>
            <div class="relative">
              <input type="password" name="password" required placeholder="Enter your password" id="id_password"
                class="w-full pr-12">
              <i class="ph-fill ph-eye cursor-pointer text-lg text-light/40 absolute right-3 top-1/2 -translate-y-1/2 hover:text-accent transition-colors"
                id="togglePassword"></i>
            </div>
            <div class="text-right mt-2">
              <a href="{% url 'account_reset_password' %}"
                class="text-secondary hover:text-secondary/80 text-xs retro-text">
                Forgot?
              </a>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit"
          class="retro-form-btn w-full bg-primary text-dark border-primary hover:bg-secondary hover:border-secondary mt-8 flex items-center justify-center gap-3">
          <i class="ph-bold ph-sign-in text-sm"></i>
          <span class="button-text">Login</span>
        </button>

        <!-- OR Divider -->
        <div class="my-6 flex items-center">
          <div class="flex-grow h-px bg-light/20"></div>
          <span class="mx-4 font-pixel text-xs text-light/40">OR</span>
          <div class="flex-grow h-px bg-light/20"></div>
        </div>
      </form>

      <!-- Google Login -->
      <div class="flex items-center justify-center">
        {% include "components/google_onetap.html" %}
      </div>

      <!-- Footer -->
      <div class="pixel-accent-amber mt-8 mb-4"></div>
      <p class="text-light/40 text-xs text-center retro-text">
        By logging in, you agree to
        <a href="{% url 'terms_and_conditions' %}" class="text-primary hover:underline">Terms</a> and
        <a href="{% url 'privacy_policy' %}" class="text-primary hover:underline">Privacy</a>
      </p>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("login_form");
    const togglePassword = document.getElementById("togglePassword");
    const passwordInput = document.getElementById("id_password");
    const submitBtn = form.querySelector('button[type="submit"]');
    const buttonText = submitBtn.querySelector(".button-text");
    const buttonIcon = submitBtn.querySelector("i");

    form.addEventListener("submit", function (e) {
      if (!form.checkValidity()) {
        e.preventDefault();
        showToast("Please fill in all required fields", 3000, "ERROR");
      } else {
        submitBtn.disabled = true;
        buttonIcon.className = "ph-bold ph-circle-notch animate-spin text-sm";
        buttonText.textContent = "Logging in...";
      }
    });

    togglePassword.addEventListener("click", () => {
      if (passwordInput.type === "password") {
        passwordInput.type = "text";
        togglePassword.classList.remove("ph-eye");
        togglePassword.classList.add("ph-eye-slash");
      } else {
        passwordInput.type = "password";
        togglePassword.classList.remove("ph-eye-slash");
        togglePassword.classList.add("ph-eye");
      }
    });
  });
</script>
{% if form.errors %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    {%for err in form.non_field_errors %} showToast("{{ err }}", 3000, 'ERROR'); {% endfor %}
  });
</script>
{% for field in form %}
{% for error in field.errors %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    showToast("{{ error }}", 3000, "ERROR");
  });
</script>
{% endfor %}
{% endfor %}
{% endif %}
{% endblock content %}